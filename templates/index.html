{% extends "base.html" %}

{% block title %}PCOS Data Analysis Platform{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row align-items-center">
        <div class="col-lg-6">
            <h1 class="display-4 fw-bold lh-1 mb-3">PCOS Data Analysis Platform</h1>
            <p class="lead">An advanced data analytics and visualization platform for PCOS research and analysis.</p>
            <div class="d-grid gap-2 d-md-flex justify-content-md-start mb-4">
                <a href="/training" class="btn btn-primary btn-lg px-4">
                    <i class="fas fa-graduation-cap me-2"></i>Data Training
                </a>
                <a href="/analyze" class="btn btn-outline-secondary btn-lg px-4 me-md-2">
                    <i class="fas fa-chart-line me-2"></i>Data Analysis
                </a>
            </div>
        </div>
    </div>

    <div class="row mt-5">
        <div class="col-12">
            <h2 class="text-center mb-4">Data Science Features</h2>
        </div>
    </div>

    <div class="row g-4 py-5">
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-calculator text-primary me-2"></i>
                        Statistical Analysis
                    </h3>
                    <p class="card-text">Perform comprehensive statistical analysis on PCOS data, including correlation analysis, distribution analysis, and summary statistics.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-chart-pie text-primary me-2"></i>
                        Data Visualization
                    </h3>
                    <p class="card-text">Create interactive visualizations including scatter plots, histograms, box plots, and correlation heatmaps.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-brain text-primary me-2"></i>
                        Pattern Recognition
                    </h3>
                    <p class="card-text">Identify patterns and relationships in PCOS data through advanced data analysis techniques.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-database text-primary me-2"></i>
                        Data Management
                    </h3>
                    <p class="card-text">Efficiently manage and process large datasets with our robust data handling capabilities.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-tachometer-alt text-primary me-2"></i>
                        Insights Dashboard
                    </h3>
                    <p class="card-text">Access a comprehensive dashboard with key insights and metrics from your PCOS data analysis.</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card h-100">
                <div class="card-body">
                    <h3 class="card-title h5">
                        <i class="fas fa-file-export text-primary me-2"></i>
                        Data Export
                    </h3>
                    <p class="card-text">Export your analysis results and visualizations in various formats for further research and reporting.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="container mt-5">
    <form id="analyzeForm">
        <div class="row">
            <div class="col-12">
                <h2 class="text-center mb-4">Data Analysis</h2>
            </div>
        </div>

        <div class="row g-4">
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 1
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question1" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 2
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question2" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 3
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question3" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 4
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question4" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 5
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question5" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 6
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question6" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 7
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question7" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 8
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question8" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 9
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question9" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-body">
                        <h3 class="card-title h5">
                            <i class="fas fa-question-circle text-primary me-2"></i>
                            Question 10
                        </h3>
                        <p class="card-text">
                            <input type="text" class="form-control" name="question10" placeholder="Enter your answer">
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-12">
                <div class="d-flex justify-content-center">
                    <div class="progress" style="width: 50%;">
                        <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <span id="progress-text" class="ms-2">0/10 Answered</span>
                </div>
            </div>
            <div class="col-12">
                <div class="d-flex justify-content-center">
                    <div>
                        <button type="button" class="btn btn-secondary me-2" id="randomBtn">Generate Random Input</button>
                        <button type="button" class="btn btn-danger me-2" id="resetBtn">Reset Form</button>
                        <button type="submit" class="btn btn-primary" id="analyzeBtn">Analyze</button>
                    </div>
                </div>
            </div>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const totalQuestions = {{ questions|length }};
        let answeredQuestions = 0;
        const progressBar = document.querySelector('.progress-bar');
        const progressText = document.getElementById('progress-text');
        const errorMessages = document.getElementById('error-messages');
        const analyzeForm = document.getElementById('analyzeForm');
        const randomBtn = document.getElementById('randomBtn');
        const resetBtn = document.getElementById('resetBtn');

        // Function to update progress
        function updateProgress() {
            const progress = (answeredQuestions / totalQuestions) * 100;
            progressBar.style.width = progress + '%';
            progressText.textContent = `${answeredQuestions}/${totalQuestions} Answered`;
            // Update analyze button state
            const analyzeBtn = document.getElementById('analyzeBtn');
            if (analyzeBtn) {
                 analyzeBtn.disabled = answeredQuestions !== totalQuestions;
            }
        }

        // Handle random input button
        randomBtn.addEventListener('click', async function() {
            try {
                // Show loading state
                randomBtn.disabled = true;
                randomBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Loading...';
                
                // Fetch random data
                const response = await fetch('/analyze/random-data');
                const result = await response.json();
                
                if (result.success) {
                    // Fill all input fields with random data
                    document.querySelectorAll('input[type="text"]').forEach(function(input) {
                        const questionName = input.getAttribute('name');
                        const value = result.data[questionName];
                        
                        if (value !== undefined) {
                            input.value = value;
                            
                            // Update answered status
                            const questionCard = input.closest('.question-card');
                            if (!questionCard.dataset.answered) {
                                answeredQuestions++;
                                questionCard.dataset.answered = 'true';
                            }
                        }
                    });
                    
                    // Update progress
                    updateProgress();
                    
                    // Show success message
                    const alert = document.createElement('div');
                    alert.className = 'alert alert-success alert-dismissible fade show';
                    alert.innerHTML = `
                        <i class="fas fa-check-circle me-2"></i>Random data loaded successfully
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    `;
                    document.querySelector('.card-body').insertBefore(alert, document.querySelector('.progress'));
                    
                    // Auto-dismiss alert after 3 seconds
                    setTimeout(() => {
                        alert.remove();
                    }, 3000);
                } else {
                    throw new Error(result.error);
                }
            } catch (error) {
                // Show error message
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger alert-dismissible fade show';
                alert.innerHTML = `
                    <i class="fas fa-exclamation-circle me-2"></i>${error.message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                document.querySelector('.card-body').insertBefore(alert, document.querySelector('.progress'));
            } finally {
                // Reset button state
                randomBtn.disabled = false;
                randomBtn.innerHTML = '<i class="fas fa-random me-2"></i>Generate Random Input';
            }
        });

        // Reset button functionality
        resetBtn.addEventListener('click', function() {
            analyzeForm.reset(); // Reset the form fields
            updateProgress(); // Update the progress bar and text
            if (errorMessages) {
                errorMessages.innerHTML = ''; // Clear any error messages
            }
             // Clear input field validity states (Bootstrap validation classes)
            analyzeForm.querySelectorAll('.form-control').forEach(input => {
                input.classList.remove('is-valid', 'is-invalid');
            });
        });

        // Initial progress update
        updateProgress();

        // Event listener for form submission (existing)
        analyzeForm.addEventListener('submit', async function(event) {
                    event.preventDefault();
            
            // Validate all questions are answered
            let allAnswered = true;
            document.querySelectorAll('.question-card').forEach(function(card) {
                const input = card.querySelector('input[type="text"]');
                const value = input.value.trim();
                
                if (value === '') {
                    allAnswered = false;
                    const errorMessage = card.querySelector('.error-message');
                    errorMessage.textContent = 'Please enter a value';
                    errorMessage.style.display = 'block';
                }
            });
            
            if (allAnswered) {
                // Show loading state
                const analyzeBtn = document.getElementById('analyzeBtn');
                 if (analyzeBtn) {
                     analyzeBtn.disabled = true;
                    analyzeBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Analyzing...';
                }
                
                // Submit the form
                analyzeForm.submit();
            } else {
                // Scroll to first unanswered question
                const firstError = document.querySelector('.error-message[style="display: block"]');
                if (firstError) {
                    firstError.closest('.question-card').scrollIntoView({
                        behavior: 'smooth',
                        block: 'center'
                    });
                }
            }
        });

        // Handle input changes
        document.querySelectorAll('input[type="text"]').forEach(function(input) {
            input.addEventListener('input', function() {
                const questionCard = this.closest('.question-card');
                const questionName = input.getAttribute('name');
                
                // Check if this is the first answer for this question
                if (!questionCard.dataset.answered && this.value.trim() !== '') {
                    answeredQuestions++;
                    questionCard.dataset.answered = 'true';
                } else if (questionCard.dataset.answered && this.value.trim() === '') {
                    answeredQuestions--;
                    questionCard.dataset.answered = '';
                }
                
                // Remove error message if it exists
                const errorMessage = questionCard.querySelector('.error-message');
                if (errorMessage) {
                    errorMessage.style.display = 'none';
                }
                
                updateProgress();
            });
        });
    });
</script>
{% endblock %} 